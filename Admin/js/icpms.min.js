(function(e){
	"use strict";
	e.t = {
		baseURI:'../../API/admin.php',
		ua:function(){
			const u = navigator.userAgent;
			return{
				m: !!u.match(/AppleWebKit.*Mobile.*/),
				a: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1,
				i: u.indexOf('iPhone') > -1,
				w: u.indexOf('MicroMessenger') > -1
			}
		},
		checkICP:function(e){
			layer.load(2);
			$.ajax({
				url: this.baseURI,
				type: 'GET',
				data: {a:'checkICP',c:e.e,d:e.d},
				success:function(t){
					e.p(t);
					layer.closeAll('loading');
				},
				error:function(){
					layer.closeAll('loading');
				}
			});
		}
	}

	isAdmin();
	setInterval(function(){
		isAdmin();
	},10000);

	function isAdmin(){
		const token = sessionStorage.getItem("token");
		if(token == null){
			window.location.href="index.html";
		}else(
			$.ajax({
				url: t.baseURI,
				type: 'GET',
				data: {
					a: 'isadmin',
					t:token
				},
				success:function(e){
					if(e.data.errCode !== 200){
						window.location.href="index.html";
					}
				},
				error:function(){
					window.location.href="index.html";
				}
			})
			)

	}

	$(function(){
		if(t.ua().m || t.ua().a || t.ua().i || t.ua().w){
			$("body").empty();
			layer.msg('\u4e3a\u4e86\u7cfb\u7edf\u5b89\u5168\uff0c\u8bf7\u901a\u8fc7\u0050\u0043\u7aef\u8bbf\u95ee\u3002',{icon:2});
		}
		$("#rightContent").load("ICPMS_home.html");
		$("header a").click(function(){
			sessionStorage.clear();
			window.location.href="index.html";
		});
		$("#leftNav > .navPannel a").click(function(e){
			$("#leftNav > .navPannel a").removeClass("active");
			$(this).addClass("active");
			switch (this.name) {
				case 'ICPMS_audit.html':
				$("#rightContent").html(t.bm)
				break;
				case 'ICPMS_completed.html':
				$("#rightContent").html(t.cm)
				break;
				default:
				$("#rightContent").load(this.name);
				break;
			}
			
		})
	});



	// 模板引擎
	
	t.bm = `<div class="container"><div class="content-panel"><div class="content-panel-title">待审核列表</div><table class="layui-hide" id="list" lay-filter="list"></table></div></div><script type="text/html" id="option"><div class="layui-btn-container"><button class="layui-btn layui-btn-sm" lay-event="pass">通过备案</button><button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="back">退回备案</button><button class="layui-btn layui-btn-sm layui-btn-primary" lay-event="reload">刷新</button></div></script><script>layui.use('table',function(){var table = layui.table;table.render({elem:'#list',url:t.baseURI+'?a=getIcplist&s=2',height:'full-200',limit:20,toolbar:'#option',defaultToolbar:[],title:'待审核列表',cols:[[{type:'checkbox'},{field:'inum',title:'备案号'},{field:'name',title:'所有者',},{field:'email',title:'管理邮箱'},{field:'name',title:'网站名称',},{field:'domain',title:'网站域名',},{field:'desp',title:'网站描述',},{field:'time',title:'备案时间',}]],page:true,response:{statusCode:200},parseData:function(res){return{"code":res.errCode,"count":res.data.count,"data":res.data.datas}}});table.on('toolbar(list)',function(e){let checkStatus = table.checkStatus(e.config.id);if(e.event == "reload"){table.reload("list")}else{if(checkStatus.data.length>0){if(e.event == "pass"){e.msg = "确定通过审核选中的备案信息？"}else if(e.event == "back"){e.msg = "确定退回选中的备案信息？"}layer.confirm(e.msg,function(index){let datas = [];for(i in checkStatus.data){datas.push(checkStatus.data[i].inum)}window.t.checkICP({e:e.event,d:datas,p:(e)=>{table.reload("list");layer.close(index)}})})}}})});</script>`;
	t.cm = `<div class="container"><div class="content-panel"><div class="content-panel-title">已备案列表</div><table class="layui-hide"id="list"lay-filter="list"></table></div></div><script type="text/html"id="option"><div class="layui-btn-container"><button class="layui-btn layui-btn-sm layui-btn-danger"lay-event="lock">注销备案</button><button class="layui-btn layui-btn-sm layui-btn-primary"lay-event="reload">刷新</button></div></script><script type="text/html"id="checkLock"><input type="checkbox"name="lock"value="{{d.inum}}"title="{{d.status == 0 ?'注销':'正常'}}"lay-filter="lock"{{d.status==0?'checked':''}}></script><script>layui.use(['table','form'],function(){var table=layui.table,form=layui.form;table.render({elem:'#list',url:t.baseURI+'?a=getIcplist&s=1',height:'full-200',limit:20,toolbar:'#option',defaultToolbar:[],title:'已完成列表',cols:[[{type:'checkbox'},{field:'inum',title:'备案号'},{field:'name',title:'所有者',},{field:'email',title:'管理邮箱'},{field:'name',title:'网站名称',},{field:'domain',title:'网站域名',},{field:'desp',title:'网站描述',},{field:'time',title:'备案时间',},{field:'lock',title:'是否注销',width:110,templet:'#checkLock',unresize:true,fixed:'right'}]],page:true,response:{statusCode:200},parseData:function(res){return{"code":res.errCode,"count":res.data.count,"data":res.data.datas}}});table.on('toolbar(list)',function(e){let checkStatus=table.checkStatus(e.config.id);if(e.event=="reload"){table.reload("list")}else{if(checkStatus.data.length>0){layer.confirm("确定注销选中的备案信息？",function(index){let datas=[];for(i in checkStatus.data){datas.push(checkStatus.data[i].inum)}window.t.checkICP({e:e.event,d:datas,p:(e)=>{table.reload("list");layer.close(index)}})})}}});form.on('checkbox(lock)',function(e){let sobj=e;if(this.checked){e.event="lock"}else{e.event="pass"}window.t.checkICP({e:e.event,d:this.value,p:(e)=>{if(e.errCode==200&&e.data.errCode==200){if(e.data.errMsg=="lock"){layer.tips("已注销备案信息",sobj.othis,{tips:[4,'#FF0000']})}else{layer.tips("备案信息已正常",sobj.othis,{tips:[4,'#78BA32']})}}}})})});</script>`;

})(window);